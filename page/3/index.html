<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>H博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="编程博客">
<meta name="keywords" content="c++ java mysql shell linux h博客 android docker git laravel php python javascript python">
<meta property="og:type" content="website">
<meta property="og:title" content="H博客">
<meta property="og:url" content="https://blog.newtao.vip/page/3/index.html">
<meta property="og:site_name" content="H博客">
<meta property="og:description" content="编程博客">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="H博客">
<meta name="twitter:description" content="编程博客">
  
    <link rel="alternate" href="/atom.xml" title="H博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="/css/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<style>
.breathe-div {
    width: 200px;
    height: 200px;
    border: 1px solid #2b92d4;
    border-radius: 50%;
    text-align: center;
    cursor: pointer;
    margin:0px auto;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    overflow: hidden;
    z-index: 10;
    -webkit-animation-timing-function: ease-in-out;
    -webkit-animation-name: breathe;
    -webkit-animation-duration: 1500ms;
    -webkit-animation-iteration-count: infinite;
    -webkit-animation-direction: alternate;
}

@-webkit-keyframes breathe {
    0% {
        opacity: .4;
        box-shadow: 0 1px 2px rgba(0, 147, 223, 0.4), 0 1px 1px rgba(0, 147, 223, 0.1) inset;
    }

    100% {
        opacity: 1;
        border: 1px solid rgba(59, 235, 235, 0.7);
        box-shadow: 0 1px 30px #0093df, 0 1px 20px #0093df inset;
    }
}
.breathe-point{position:absolute;left:50%; top:150px;}
.breathe-div{position:absolute;left:-100px; top:-100px }
</style>
<body>
  <div class="breathe-point">
  <div class="breathe-div"></div>
  </div>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">H博客</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">技术博客</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://blog.newtao.vip"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="true-web3" class="article article-type-true" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/04/28/web3/" class="article-date">
  <time datetime="2020-04-28T09:14:39.967Z" itemprop="datePublished">2020-04-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/区块链/">区块链</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/04/28/web3/">Web3 私钥签名交易 免解锁账号</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li><p>示例程序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">var Web3 = require(&apos;web3&apos;);</span><br><span class="line">var fs = require(&quot;fs&quot;)</span><br><span class="line">try &#123;</span><br><span class="line">  web3 = new Web3(new Web3.providers.HttpProvider(&quot;http://47.114.114.93:8545&quot;));</span><br><span class="line">  var abi = eval(fs.readFileSync(&apos;./static/abi2.txt&apos;).toString());</span><br><span class="line">  var gcontract = fs.readFileSync(&apos;./static/2.txt&apos;).toString();</span><br><span class="line">  var contract = new web3.eth.Contract(abi, gcontract);</span><br><span class="line">  var transfer = contract.methods.doLottery();</span><br><span class="line">  var encodedABI = transfer.encodeABI();</span><br><span class="line">  var from = &quot;0x1b4f60adE059d2eC70b30478da012D254493Ea24&quot;;</span><br><span class="line">  web3.eth.getTransactionCount(from).then(result =&gt; &#123;</span><br><span class="line">    var number = result.toString(16);</span><br><span class="line">    var tx = &#123;</span><br><span class="line">      nonce: &apos;0x&apos; + number,</span><br><span class="line">      from: &quot;0x1b4f60adE059d2eC70b30478da012D254493Ea24&quot;,</span><br><span class="line">      to: gcontract,</span><br><span class="line">      gas: 6000000,</span><br><span class="line">      data: encodedABI</span><br><span class="line">    &#125;;</span><br><span class="line">    privateKey = &apos;AEA805B16F7A7BD4916737880A2E768DEC1AE3B6A96CB067E5373D412A119566&apos;;</span><br><span class="line">    web3.eth.accounts.signTransaction(tx, privateKey).then(signed =&gt; &#123;</span><br><span class="line">      console.log(signed);</span><br><span class="line">      var tran = web3.eth.sendSignedTransaction(signed.rawTransaction);</span><br><span class="line">      tran.on(&apos;confirmation&apos;, (confirmationNumber, receipt) =&gt; &#123;</span><br><span class="line">        console.log(&apos;confirmation: &apos; + confirmationNumber);</span><br><span class="line">        console.log(receipt);</span><br><span class="line">      &#125;);</span><br><span class="line">      tran.on(&apos;transactionHash&apos;, hash =&gt; &#123;</span><br><span class="line">        console.log(&apos;hash&apos;);</span><br><span class="line">        console.log(hash);</span><br><span class="line">      &#125;);</span><br><span class="line">      tran.on(&apos;receipt&apos;, receipt =&gt; &#123;</span><br><span class="line">        console.log(&apos;reciept&apos;);</span><br><span class="line">        console.log(receipt);</span><br><span class="line">      &#125;);</span><br><span class="line">      tran.on(&apos;error&apos;, console.error);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125; catch (err) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>参考链接<br><a href="http://cw.hubwiz.com/card/c/web3.js-1.0/1/2/22/" target="_blank" rel="noopener">http://cw.hubwiz.com/card/c/web3.js-1.0/1/2/22/</a><br><a href="https://www.jianshu.com/p/3732f39b5638" target="_blank" rel="noopener">https://www.jianshu.com/p/3732f39b5638</a><br><a href="http://cw.hubwiz.com/card/c/ethereum-FAQ/1/1/5/" target="_blank" rel="noopener">http://cw.hubwiz.com/card/c/ethereum-FAQ/1/1/5/</a></p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.newtao.vip/2020/04/28/web3/" data-id="ckd6ppw76004mq7784xc8jkh2" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="true-weevely" class="article article-type-true" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/04/28/weevely/" class="article-date">
  <time datetime="2020-04-28T09:13:04.153Z" itemprop="datePublished">2020-04-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/04/28/weevely/">weevely</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li>安装</li>
</ol>
<ul>
<li><p>linux</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$sudo apt-get install g++ python-pip libyaml-dev python-dev</span><br><span class="line"></span><br><span class="line">$sudo pip install prettytable Mako PyYAML python-dateutil PySocks --upgrade</span><br></pre></td></tr></table></figure>
</li>
<li><p>OS X</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo port install python27 py27-pip</span><br><span class="line">$ sudo port select --set pip pip27</span><br><span class="line">$ sudo port select --set python python27</span><br><span class="line">$ sudo pip install prettytable Mako PyYAML python-dateutil readline PySocks --upgrade</span><br></pre></td></tr></table></figure>
</li>
<li><p>Windows</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install prettytable Mako PyYAML python-dateutil pyreadline PySocks --upgrade</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ol start="2">
<li><p>生成后门</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">weevely generate test backdoor.php</span><br></pre></td></tr></table></figure>
</li>
<li><p>连接后门</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">weevely http://ip/backdoor.php test</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>4.:help</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.newtao.vip/2020/04/28/weevely/" data-id="ckd6ppw7d004rq778admiinao" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="true-nethogs" class="article article-type-true" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/04/28/nethogs/" class="article-date">
  <time datetime="2020-04-28T09:13:04.152Z" itemprop="datePublished">2020-04-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/04/28/nethogs/">Nethogs</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Linux查看某进程使用的网络带宽情况<br>（1）可能查看某个进程的带宽占用需要明确知道PID、进程名字、发送速度、接收速度。</p>
<p>（2）在Linux原生的软件中没有，只能外装，最符合以上的情况就只有nethogs。</p>
<p>（3）nethogs可以指定网卡，但是不能指定PID，这就是一个缺陷。</p>
<p>2、使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nethogs</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.newtao.vip/2020/04/28/nethogs/" data-id="ckd6ppw42002gq778n21seyv6" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="true-mv" class="article article-type-true" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/04/28/mv/" class="article-date">
  <time datetime="2020-04-28T09:13:04.152Z" itemprop="datePublished">2020-04-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/04/28/mv/">mv</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>1.通过mv 唯一处理文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">hash=$(md5sum $1|awk &apos;&#123;print $1&#125;&apos;)</span><br><span class="line">if [ ! -f ~/.local/$hash ];then</span><br><span class="line">    echo $hash</span><br><span class="line">    mv $1 ~/.local/$hash</span><br><span class="line">else</span><br><span class="line">    echo &apos;have&apos;</span><br><span class="line">    rm -rf $1</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.newtao.vip/2020/04/28/mv/" data-id="ckd6ppw3r0028q778t00m66hz" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="true-hack" class="article article-type-true" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/04/28/hack/" class="article-date">
  <time datetime="2020-04-28T09:13:04.138Z" itemprop="datePublished">2020-04-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/04/28/hack/">Hacker</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>网络安全 安全攻防 漏洞</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.newtao.vip/2020/04/28/hack/" data-id="ckd6ppw2m001bq778o592qiij" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="true-color" class="article article-type-true" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/04/28/color/" class="article-date">
  <time datetime="2020-04-28T09:10:08.545Z" itemprop="datePublished">2020-04-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/前端/">前端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/04/28/color/">Color</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li>适合阅读的背景颜色<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">* 河白色 #FFFFFF rgb(255, 255, 255)</span><br><span class="line">* 杏仁黄 #FAF9DE rgb(250, 249, 222)</span><br><span class="line">* 秋叶褐 #FFF2E2 rgb(255, 242, 226)</span><br><span class="line">* 胭脂红 #FDE6E0 rgb(253, 230, 224)</span><br><span class="line">* 青草绿 #E3EDCD rgb(227, 237, 205)</span><br><span class="line">* 海天蓝 #DCE2F1 rgb(220, 226, 241)</span><br><span class="line">* 葛巾紫 #E9EBFE rgb(233, 235, 254)</span><br><span class="line">* 极光灰 #EAEAEF rgb(234, 234, 239)</span><br></pre></td></tr></table></figure>

</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.newtao.vip/2020/04/28/color/" data-id="ckd6ppw1h000mq778m85sr236" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="true-blockchain_btc" class="article article-type-true" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/04/28/blockchain_btc/" class="article-date">
  <time datetime="2020-04-28T09:08:15.747Z" itemprop="datePublished">2020-04-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/区块链/">区块链</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/04/28/blockchain_btc/">区块链-比特币</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>2008年爆发全球金融危机，2008年11月1日，一个自称中本聪（Satoshi Nakamoto）的人在P2P foundation网站上发布了比特币白皮书《比特币：一种点对点的电子现金系统》  ，陈述了他对电子货币的新设想——比特币就此面世。</p>
<p>2009年1月3日，比特币创世区块诞生。和法定货币相比，比特币没有一个集中的发行方，而是由网络节点的计算生成，谁都有可能参与制造比特币，而且可以全世界流通，可以在任意一台接入互联网的电脑上买卖，不管身处何方，任何人都可以挖掘、购买、出售或收取比特币，并且在交易过程中外人无法辨认用户身份信息。</p>
<p>2009年1月5日，不受央行和任何金融机构控制的比特币诞生。比特币是一种数字货币，由计算机生成的一串串复杂代码组成，新比特币通过预设的程序制造。每当比特币进入主流媒体的视野时，主流媒体总会请一些主流经济学家分析一下比特币。早先，这些分析总是集中在比特币是不是骗局。而现如今的分析总是集中在比特币能否成为未来的主流货币。而这其中争论的焦点又往往集中在比特币的通缩特性上。 不少比特币玩家是被比特币的不能随意增发所吸引的。和比特币玩家的态度截然相反，经济学家们对比特币2100万固定总量的态度两极分化。凯恩斯学派的经济学家们认为政府应该积极调控货币总量，用货币政策的松紧来为经济适时的加油或者刹车。因此，他们认为比特币固定总量货币牺牲了可调控性，而且更糟糕的是将不可避免地导致通货紧缩，进而伤害整体经济。奥地利学派经济学家们的观点却截然相反，他们认为政府对货币的干预越少越好，货币总量的固定导致的通缩并没什么大不了的，甚至是社会进步的标志。比特币网络通过“挖矿”来生成新的比特币。所谓“挖矿”实质上是用计算机解决一项复杂的数学问题，来保证比特币网络分布式记账系统的一致性。比特币网络会自动调整数学问题的难度，让整个网络约每10分钟得到一个合格答案。随后比特币网络会新生成一定量的比特币作为区块奖励，奖励获得答案的人。 </p>
<p>2009年比特币诞生的时候，区块奖励是50个比特币。诞生10分钟后，第一批50个比特币生成了，而此时的货币总量就是50。随后比特币就以约每10分钟50个的速度增长。当总量达到1050万时(2100万的50%)，区块奖励减半为25个。当总量达到1575万(新产出525万，即1050的50%)时，区块奖励再减半为12.5个。该货币系统曾在4年内只有不超过1050万个，之后的总数量将被永久限制在约2100万个。 比特币是一种虚拟货币，数量有限，但是可以用来套现：可以兑换成大多数国家的货币。你可以使用比特币购买一些虚拟的物品，比如网络游戏当中的衣服、帽子、装备等，只要有人接受，你也可以使用比特币购买现实生活当中的物品。</p>
<p>2014年2月25日，“比特币中国”的比特币开盘价格为3562.41元，截至下午4点40分，价格已下跌至3185元，跌幅逾10%。根据该平台的历史行情数据显示，在2014年1月27日，1比特币还能兑换5032元人民币。这意味着，该平台上不到一个月，比特币价格已下跌了36.7%。</p>
<p>2014年9月9日，美国电商巨头eBay宣布，该公司旗下支付处理子公司Braintree将开始接受比特币支付。该公司已与比特币交易平台Coinbase达成合作，开始接受这种相对较新的支付手段。<br>虽然eBay市场交易平台和PayPal业务还不接受比特币支付，但旅行房屋租赁社区Airbnb和租车服务Uber等Braintree客户将可开始接受这种虚拟货币。Braintree的主要业务是面向企业提供支付处理软件，该公司在2013年被eBay以大约8亿美元的价格收购。</p>
<p>2017年1月22日晚间，火币网、比特币中国与OKCoin币行相继在各自官网发布公告称，为进一步抑制投机，防止价格剧烈波动，各平台将于2017年1月24日中午12：00起开始收取交易服务费，服务费按成交金额的0.2%固定费率收取，且主动成交和被动成交费率一致。  5月5日，OKCoin币行网的最新数据显示，比特币的价格刚刚再度刷新历史，截止发稿前最高触及9222元人民币高位。1月24日中午12：00起，中国三大比特币平台正式开始收取交易费。9月4日，央行等七部委发公告称中国禁止虚拟货币交易。</p>
<p>2017年12月17日，比特币达到历史最高价19850美元。</p>
<p>2018年11月25日，比特币跌破4000美元大关，后稳定在3000多美元。 11月19日，加密货币恢复跌势，比特币自2017年10月以来首次下探5000美元大关，原因是之前BCH出现硬分叉，且监管部门对首次代币发行（ICO）加强了审查。 11月21日凌晨4点半，coinbase平台比特币报价跌破4100美元，创下了13个月以来的新低。</p>
<p>2019年4月，比特币再次突破5000美元大关，创年内新高。 5月12日，比特币近八个月来首次突破7000美元。 2019年5月14日，据coinmarketcap报价显示，比特币站上8000美元，24小时内上涨14.68%。 </p>
<p>2019年6月22日 ，比特币价格突破10000美元大关。比特币价格在10200左右震荡，24小时涨幅近7%。  6月26日，比特币价格一举突破12000美元，创下自去年1月来近17个月高点。  6月27日早间，比特币价格一度接近14000美元，再创年内新高。</p>
<p>2020年2月10日，比特币突破了一万美元。据交易数据，比特币的价格涨幅突破3%，自去年10月26日以来首次突破一万美元的心理界限。</p>
<p>2020年3月12日，据加密货币交易平台Bitstamp数据显示，19点44分，比特币最低价格已跌至5731美元。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.newtao.vip/2020/04/28/blockchain_btc/" data-id="ckd6ppw19000hq7783ixahh8o" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="true-matchmaking_engine" class="article article-type-true" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/04/28/matchmaking_engine/" class="article-date">
  <time datetime="2020-04-28T09:04:09.270Z" itemprop="datePublished">2020-04-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/交易所/">交易所</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/04/28/matchmaking_engine/">撮合引擎学习</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>交易撮合引擎（Matching/Trading Engine），顾名思义是用来撮合交易的软件，广泛地应用在 金融、证券、加密货币交易等领域。交易引擎负责管理加密资产市场中所有的开口订单（Open Orders）， 并在发现匹配的订单对（Trading Pair）时自动执行交易。本文将首先介绍有关加密资产交易撮合 引擎的基本概念，例如委托单、交易委托账本等，然后使用Golang实现一个原理性的撮合引擎。如果你正在 考虑实现类似交易所（Exchange）这样的产品，相信本文会对你有很大的帮助。</p>
<p>可以这样先思考一下：如果你要实现一个供人们将以太币兑换为比特币的市场，那么你就需要跟踪一些信息， 例如以太币的买/卖价格（以比特币计算）、哪些买单或卖单还没有执行等等，同时还要处理新进来的委托单。 将这一思路扩展到多个交易对，然后再集成钱包功能，你就实现了一个完整的交易引擎，就像 币安一样。</p>
<p>本文的完整源码下载地址：<a href="https://github.com/ezpod/crypto-exchange-engine" target="_blank" rel="noopener">crypto-exchange-engine</a></p>
<h1 id="1、基本概念与术语"><a href="#1、基本概念与术语" class="headerlink" title="1、基本概念与术语"></a>1、基本概念与术语</h1><p>在开始打造交易撮合引擎之前，让我们首先熟悉相关的基本概念与术语。</p>
<h2 id="撮合-交易引擎"><a href="#撮合-交易引擎" class="headerlink" title="撮合/交易引擎"></a>撮合/交易引擎</h2><p>正如前面所述，交易撮合引擎是用来撮合交易的软件，可以先把交易撮合引擎看作 一个黑盒子，它有一些输入和输出。<br>例如，可能的输入包括：</p>
<ul>
<li>创建新的委托单（NewOrder）：一个新的委托单可以作为交易撮合引擎的输入，引擎会尝试将其与已有的 委托单进行撮合。</li>
<li>取消已有的委托单（CancelOrder）：用户也可以取消一个之前输入的委托单，如果它还没有执行的话，即开口订单。</li>
</ul>
<p>当然你可以定义其他的输入，出于简化考虑，我们现在只定义上述两个输入。</p>
<p>交易撮合引擎的输出是一些事件，以便及时通知其他应用处理。例如，当 引擎撮合了一笔交易后，就会触发一个TradesGenerated事件；而当取消了 一个已有的委托单后，引擎就会触发OrderCancelled。同样，你可以根据自己 的需求来定义引擎的输出，这里我们还是简单点，只定义这两个输出事件。</p>
<h2 id="交易委托账本"><a href="#交易委托账本" class="headerlink" title="交易委托账本"></a>交易委托账本</h2><p>交易委托账本（Order Book）就是一个买方委托单或买方委托单的列表，通常按照 价格和时间排序。</p>
<p>当一个新的买方（买方）委托单进入引擎后，引擎就会将尝试其与现有的卖方（买方）委托账本 进行匹配，看是否存在执行交易的可能。如果找到了匹配的对手单，引擎就可以执行这两个 委托单了，也就是撮合成功了。</p>
<h2 id="委托单"><a href="#委托单" class="headerlink" title="委托单"></a>委托单</h2><p>在任何交易引擎中，都可能有多种类型的委托单供用户选择。其中常见的类型包括：</p>
<ul>
<li>限价委托单<br>限价委托单是在当前的加密货币交易环境中最常用的委托类型。这种委托单允许用户 指定一个价格，只有当撮合引擎找到同样价格甚至更好价格的对手单时才执行交易。<br>对于一个买方委托单而言，这意味着如果你的委托价格是￥100，那么该委托单将会 在任何不高于￥100的价格成交 —— 买到指定的价格或者更便宜的价格；而对于一个 卖方委托单而言，同样的委托价格意味着该委托单将在任何不低于￥100的价格成交 —— 卖出指定的价格或者更高的价格。</li>
<li>市价委托单<br>市价委托单的撮合会完全忽略价格因素，而致力于有限完成指定数量的成交。市价 委托单在交易委托账本中有较高的优先级，在流动性充足的市场中市价单可以保证成交。</li>
</ul>
<p>例如，当用户委托购买2个以太币时，该委托单可以在￥900、￥1000、￥2000或任何 其他价位成交，这依赖于市场中当前的敞口委托单的情况。</p>
<ul>
<li>止损委托单<br>止损委托单尽在市场价格到达指定价位时才被激活，因此它的执行方式与市价委托单 相反。一旦止损委托单激活，它们可以自动转化为市价委托单或限价委托单。</li>
</ul>
<p>如果你希望打造一个高级的交易所，那么还有其他一些需要了解的概念，例如流动性、 多/空交易、FIX/FAST协议等等，但是同样出于简化考虑，我们将这些内容留给你自己 去发现。</p>
<h1 id="2、系统架构"><a href="#2、系统架构" class="headerlink" title="2、系统架构"></a>2、系统架构</h1><p>现在，对于交易撮合引擎的构成我们已经有了一些了解，那么让我们看一下整个系统 的架构，以及我们将要使用的技术：</p>
<p><img src="http://blog.hubwiz.com/2019/07/22/build-a-crypto-exchange/arch.jpg" alt="系统架构"></p>
<p>正如你上面看到的，我们的系统将包含引擎的多个客户端，这些客户端可以是交易所 系统中的其他组件，例如接收终端用户委托请求的App等等。</p>
<p>在客户端和引擎之间的通信是使用Apache Kafka作为消息总线来实现的，每个交易对 都对应Kafka的一个主题，这样我们可以确保当消息队列接收到用户委托单时，引擎 将以同样的先后顺序处理委托单。这保证了即使引擎崩溃重启我们也可以重建交易 委托账本。</p>
<p>引擎将监听Kafka主题，执行委托账本命令并将引擎的输出事件发布到消息队列中。 当然如果能够监测委托单的处理速度以及交易的执行情况会更酷。我们可以使用 Prometheus来采集性能指标，使用grafana来实现一个监视仪表盘。</p>
<h1 id="3、开发语言选择"><a href="#3、开发语言选择" class="headerlink" title="3、开发语言选择"></a>3、开发语言选择</h1><p>可以选择你熟悉的开发语言，不过由于交易撮合引擎计算量巨大，通常我们应当选择 底层系列的语言，例如：C/C++、GoLang、Rust、Java等等。在这个教程中，我们使用 Golang，因为它很快、容易理解、并发实现简单，而且我也有好久没有用C++了。</p>
<h1 id="4、开发交易撮合引擎"><a href="#4、开发交易撮合引擎" class="headerlink" title="4、开发交易撮合引擎"></a>4、开发交易撮合引擎</h1><p>我们将按照以下的步骤来开发交易撮合引擎：</p>
<ul>
<li>基础类型定义</li>
<li>Consumer实现</li>
<li>Order Book实现</li>
<li>Producer实现</li>
<li>Monitoring实现<h2 id="4-1-基础类型定义"><a href="#4-1-基础类型定义" class="headerlink" title="4.1 基础类型定义"></a>4.1 基础类型定义</h2>我们需要首先定义一些基础类型，这包括Order、OrderBook和Trade，分别表示委托单、 交易委托账本和交易：</li>
</ul>
<p>下面是engine/order.go文件的内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">package engine</span><br><span class="line"></span><br><span class="line">import &quot;encoding/json&quot;</span><br><span class="line"></span><br><span class="line">type Order struct &#123;</span><br><span class="line">	Amount uint64 `json:&quot;amount&quot;`</span><br><span class="line">	Price  uint64 `json:&quot;price&quot;`</span><br><span class="line">	ID     string `json:&quot;id&quot;`</span><br><span class="line">	Side   int8   `json:&quot;side&quot;`</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (order *Order) FromJSON(msg []byte) error &#123;</span><br><span class="line">	return json.Unmarshal(msg, order)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (order *Order) ToJSON() []byte &#123;</span><br><span class="line">	str, _ := json.Marshal(order)</span><br><span class="line">	return str</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里我们就是简单地创建了一个结构用来记录订单的主要信息，然后添加了一个 方法用于快速的JSON转换。</p>
<p>类似地engine/trade.go文件的内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">package engine</span><br><span class="line"></span><br><span class="line">import &quot;encoding/json&quot;</span><br><span class="line"></span><br><span class="line">type Trade struct &#123;</span><br><span class="line">	TakerOrderID string `json:&quot;taker_order_id&quot;`</span><br><span class="line">	MakerOrderID string `json:&quot;maker_order_id&quot;`</span><br><span class="line">	Amount       uint64 `json:&quot;amount&quot;`</span><br><span class="line">	Price        uint64 `json:&quot;price&quot;`</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (trade *Trade) FromJSON(msg []byte) error &#123;</span><br><span class="line">	return json.Unmarshal(msg, trade)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (trade *Trade) ToJSON() []byte &#123;</span><br><span class="line">	str, _ := json.Marshal(trade)</span><br><span class="line">	return str</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在我们已经定义了基本的输入和输出类型，现在看看交易委托账本 engine/order_book.go文件的内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">package engine</span><br><span class="line"></span><br><span class="line">// OrderBook type</span><br><span class="line">type OrderBook struct &#123;</span><br><span class="line">	BuyOrders  []Order</span><br><span class="line">	SellOrders []Order</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Add a buy order to the order book</span><br><span class="line">func (book *OrderBook) addBuyOrder(order Order) &#123;</span><br><span class="line">	n := len(book.BuyOrders)</span><br><span class="line">	var i int</span><br><span class="line">	for i := n - 1; i &gt;= 0; i-- &#123;</span><br><span class="line">		buyOrder := book.BuyOrders[i]</span><br><span class="line">		if buyOrder.Price &lt; order.Price &#123;</span><br><span class="line">			break</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	if i == n-1 &#123;</span><br><span class="line">		book.BuyOrders = append(book.BuyOrders, order)</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		copy(book.BuyOrders[i+1:], book.BuyOrders[i:])</span><br><span class="line">		book.BuyOrders[i] = order</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Add a sell order to the order book</span><br><span class="line">func (book *OrderBook) addSellOrder(order Order) &#123;</span><br><span class="line">	n := len(book.SellOrders)</span><br><span class="line">	var i int</span><br><span class="line">	for i := n - 1; i &gt;= 0; i-- &#123;</span><br><span class="line">		sellOrder := book.SellOrders[i]</span><br><span class="line">		if sellOrder.Price &gt; order.Price &#123;</span><br><span class="line">			break</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	if i == n-1 &#123;</span><br><span class="line">		book.SellOrders = append(book.SellOrders, order)</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		copy(book.SellOrders[i+1:], book.SellOrders[i:])</span><br><span class="line">		book.SellOrders[i] = order</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Remove a buy order from the order book at a given index</span><br><span class="line">func (book *OrderBook) removeBuyOrder(index int) &#123;</span><br><span class="line">	book.BuyOrders = append(book.BuyOrders[:index], book.BuyOrders[index+1:]...)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Remove a sell order from the order book at a given index</span><br><span class="line">func (book *OrderBook) removeSellOrder(index int) &#123;</span><br><span class="line">	book.SellOrders = append(book.SellOrders[:index], book.SellOrders[index+1:]...)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在交易委托账本中，除了创建保存买/卖方委托单的列表外，我们还需要定义添加新委托单 的方法。</p>
<p>委托单列表应当根据其类型按升序或降序排列：卖方委托单是按降序排列的，这样在列表中 序号最大的委托单价格最低；买方委托单是按升序排列的，因此在其列表中最后的委托单价格 最高。</p>
<p>由于绝大多数交易会在市场价格附近成交，我们可以轻松地从这些数组中插入或移除成员。</p>
<p>现在让我们来处理委托单。</p>
<p>在下面的代码中我们添加了一个命令来实现对限价委托单的处理。</p>
<p>文件engine/order_book_limit_order.go的内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">package engine</span><br><span class="line"></span><br><span class="line">// Process an order and return the trades generated before adding the remaining amount to the market</span><br><span class="line">func (book *OrderBook) Process(order Order) []Trade &#123;</span><br><span class="line">	if order.Side == 1 &#123;</span><br><span class="line">		return book.processLimitBuy(order)</span><br><span class="line">	&#125;</span><br><span class="line">	return book.processLimitSell(order)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Process a limit buy order</span><br><span class="line">func (book *OrderBook) processLimitBuy(order Order) []Trade &#123;</span><br><span class="line">	trades := make([]Trade, 0, 1)</span><br><span class="line">	n := len(book.SellOrders)</span><br><span class="line">	// check if we have at least one matching order</span><br><span class="line">	if n != 0 || book.SellOrders[n-1].Price &lt;= order.Price &#123;</span><br><span class="line">		// traverse all orders that match</span><br><span class="line">		for i := n - 1; i &gt;= 0; i-- &#123;</span><br><span class="line">			sellOrder := book.SellOrders[i]</span><br><span class="line">			if sellOrder.Price &gt; order.Price &#123;</span><br><span class="line">				break</span><br><span class="line">			&#125;</span><br><span class="line">			// fill the entire order</span><br><span class="line">			if sellOrder.Amount &gt;= order.Amount &#123;</span><br><span class="line">				trades = append(trades, Trade&#123;order.ID, sellOrder.ID, order.Amount, sellOrder.Price&#125;)</span><br><span class="line">				sellOrder.Amount -= order.Amount</span><br><span class="line">				if sellOrder.Amount == 0 &#123;</span><br><span class="line">					book.removeSellOrder(i)</span><br><span class="line">				&#125;</span><br><span class="line">				return trades</span><br><span class="line">			&#125;</span><br><span class="line">			// fill a partial order and continue</span><br><span class="line">			if sellOrder.Amount &lt; order.Amount &#123;</span><br><span class="line">				trades = append(trades, Trade&#123;order.ID, sellOrder.ID, sellOrder.Amount, sellOrder.Price&#125;)</span><br><span class="line">				order.Amount -= sellOrder.Amount</span><br><span class="line">				book.removeSellOrder(i)</span><br><span class="line">				continue</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	// finally add the remaining order to the list</span><br><span class="line">	book.addBuyOrder(order)</span><br><span class="line">	return trades</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Process a limit sell order</span><br><span class="line">func (book *OrderBook) processLimitSell(order Order) []Trade &#123;</span><br><span class="line">	trades := make([]Trade, 0, 1)</span><br><span class="line">	n := len(book.BuyOrders)</span><br><span class="line">	// check if we have at least one matching order</span><br><span class="line">	if n != 0 || book.BuyOrders[n-1].Price &gt;= order.Price &#123;</span><br><span class="line">		// traverse all orders that match</span><br><span class="line">		for i := n - 1; i &gt;= 0; i-- &#123;</span><br><span class="line">			buyOrder := book.BuyOrders[i]</span><br><span class="line">			if buyOrder.Price &lt; order.Price &#123;</span><br><span class="line">				break</span><br><span class="line">			&#125;</span><br><span class="line">			// fill the entire order</span><br><span class="line">			if buyOrder.Amount &gt;= order.Amount &#123;</span><br><span class="line">				trades = append(trades, Trade&#123;order.ID, buyOrder.ID, order.Amount, buyOrder.Price&#125;)</span><br><span class="line">				buyOrder.Amount -= order.Amount</span><br><span class="line">				if buyOrder.Amount == 0 &#123;</span><br><span class="line">					book.removeBuyOrder(i)</span><br><span class="line">				&#125;</span><br><span class="line">				return trades</span><br><span class="line">			&#125;</span><br><span class="line">			// fill a partial order and continue</span><br><span class="line">			if buyOrder.Amount &lt; order.Amount &#123;</span><br><span class="line">				trades = append(trades, Trade&#123;order.ID, buyOrder.ID, buyOrder.Amount, buyOrder.Price&#125;)</span><br><span class="line">				order.Amount -= buyOrder.Amount</span><br><span class="line">				book.removeBuyOrder(i)</span><br><span class="line">				continue</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	// finally add the remaining order to the list</span><br><span class="line">	book.addSellOrder(order)</span><br><span class="line">	return trades</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看起来我们将一个方法变成了两个，分别处理买方委托单和卖方委托单。这两个方法在每个方面 都很相似，除了处理的市场侧不同。</p>
<p>算法非常简单。我们将一个买方委托单与所有的卖方委托单进行匹配，找出任何与买方委托价格 一致甚至更低的卖方委托单。当这一条件不能满足时，或者该买方委托单完成后，我们返会撮合 的交易。</p>
<p>现在就快完成我们的交易引擎了，还需要接入Apache Kafka服务器，然后开始监听委托单。</p>
<p>main.go文件的内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;engine/engine&quot;</span><br><span class="line">	&quot;log&quot;</span><br><span class="line"></span><br><span class="line">	&quot;github.com/Shopify/sarama&quot;</span><br><span class="line">	cluster &quot;github.com/bsm/sarama-cluster&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line"></span><br><span class="line">	// create the consumer and listen for new order messages</span><br><span class="line">	consumer := createConsumer()</span><br><span class="line"></span><br><span class="line">	// create the producer of trade messages</span><br><span class="line">	producer := createProducer()</span><br><span class="line"></span><br><span class="line">	// create the order book</span><br><span class="line">	book := engine.OrderBook&#123;</span><br><span class="line">		BuyOrders:  make([]engine.Order, 0, 100),</span><br><span class="line">		SellOrders: make([]engine.Order, 0, 100),</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// create a signal channel to know when we are done</span><br><span class="line">	done := make(chan bool)</span><br><span class="line"></span><br><span class="line">	// start processing orders</span><br><span class="line">	go func() &#123;</span><br><span class="line">		for msg := range consumer.Messages() &#123;</span><br><span class="line">			var order engine.Order</span><br><span class="line">			// decode the message</span><br><span class="line">			order.FromJSON(msg.Value)</span><br><span class="line">			// process the order</span><br><span class="line">			trades := book.Process(order)</span><br><span class="line">			// send trades to message queue</span><br><span class="line">			for _, trade := range trades &#123;</span><br><span class="line">				rawTrade := trade.ToJSON()</span><br><span class="line">				producer.Input() &lt;- &amp;sarama.ProducerMessage&#123;</span><br><span class="line">					Topic: &quot;trades&quot;,</span><br><span class="line">					Value: sarama.ByteEncoder(rawTrade),</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			// mark the message as processed</span><br><span class="line">			consumer.MarkOffset(msg, &quot;&quot;)</span><br><span class="line">		&#125;</span><br><span class="line">		done &lt;- true</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	// wait until we are done</span><br><span class="line">	&lt;-done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//</span><br><span class="line">// Create the consumer</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">func createConsumer() *cluster.Consumer &#123;</span><br><span class="line">	// define our configuration to the cluster</span><br><span class="line">	config := cluster.NewConfig()</span><br><span class="line">	config.Consumer.Return.Errors = false</span><br><span class="line">	config.Group.Return.Notifications = false</span><br><span class="line">	config.Consumer.Offsets.Initial = sarama.OffsetOldest</span><br><span class="line"></span><br><span class="line">	// create the consumer</span><br><span class="line">	consumer, err := cluster.NewConsumer([]string&#123;&quot;127.0.0.1:9092&quot;&#125;, &quot;myconsumer&quot;, []string&#123;&quot;orders&quot;&#125;, config)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		log.Fatal(&quot;Unable to connect consumer to kafka cluster&quot;)</span><br><span class="line">	&#125;</span><br><span class="line">	go handleErrors(consumer)</span><br><span class="line">	go handleNotifications(consumer)</span><br><span class="line">	return consumer</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func handleErrors(consumer *cluster.Consumer) &#123;</span><br><span class="line">	for err := range consumer.Errors() &#123;</span><br><span class="line">		log.Printf(&quot;Error: %s\n&quot;, err.Error())</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func handleNotifications(consumer *cluster.Consumer) &#123;</span><br><span class="line">	for ntf := range consumer.Notifications() &#123;</span><br><span class="line">		log.Printf(&quot;Rebalanced: %+v\n&quot;, ntf)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//</span><br><span class="line">// Create the producer</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">func createProducer() sarama.AsyncProducer &#123;</span><br><span class="line">	config := sarama.NewConfig()</span><br><span class="line">	config.Producer.Return.Successes = false</span><br><span class="line">	config.Producer.Return.Errors = true</span><br><span class="line">	config.Producer.RequiredAcks = sarama.WaitForAll</span><br><span class="line">	producer, err := sarama.NewAsyncProducer([]string&#123;&quot;127.0.0.1:9092&quot;&#125;, config)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		log.Fatal(&quot;Unable to connect producer to kafka server&quot;)</span><br><span class="line">	&#125;</span><br><span class="line">	return producer</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>利用Golang的Sarama Kafka客户端开发库，我们可以分别创建一个接入Kafka的消费者和生产者。</p>
<p>消费者将在指定的Kafka主题上等待新的委托单，然后进行撮合处理。生成的交易接下来使用 生产者发送到指定的交易主题。</p>
<p>Kafka消息采用字节数组编码，因此我们需要将其解码。反之，将交易传入消息队列时，我们 还需要进行必要的编码。</p>
<h1 id="5、结语"><a href="#5、结语" class="headerlink" title="5、结语"></a>5、结语</h1><p>现在你有了一个可伸缩的交易引擎！完整的代码可以在GITHUB下载：crypto-exchange-engine。</p>
<p>不过这个引擎的目的是教学，另外代码还支持很多进一步的优化，例如：</p>
<ul>
<li>使用一种更高效的匹配算法</li>
<li>添加取消订单的功能</li>
<li>增强通信能力</li>
<li>委托账本的备份与恢复</li>
<li>添加监视功能</li>
</ul>
<p>英文原文链接：<a href="https://around25.com/blog/building-a-trading-engine-for-a-crypto-exchange/" target="_blank" rel="noopener">How to Build a Trading Engine </a></p>
<p>翻译原文链接: <a href="http://blog.hubwiz.com/2019/07/22/build-a-crypto-exchange/" target="_blank" rel="noopener">交易撮合引擎原理与实现【含源码】</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.newtao.vip/2020/04/28/matchmaking_engine/" data-id="ckd6ppw3n0023q7787mc7k6bv" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="true-openldap_memberof" class="article article-type-true" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/04/13/openldap_memberof/" class="article-date">
  <time datetime="2020-04-13T07:24:45.785Z" itemprop="datePublished">2020-04-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/04/13/openldap_memberof/">如何在OpenLDAP启用MemberOf</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>1.准备memberof_conf.ldif文件，内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@cdh01 openladp]# vim memberof_conf.ldif        </span><br><span class="line">#开启memberof支持</span><br><span class="line">dn: cn=module&#123;0&#125;,cn=config</span><br><span class="line">cn: modulle&#123;0&#125;</span><br><span class="line">objectClass: olcModuleList</span><br><span class="line">objectclass: top</span><br><span class="line">olcModuleload: memberof.la</span><br><span class="line">olcModulePath: /usr/lib64/openldap</span><br><span class="line"></span><br><span class="line">#新增用户支持memberof配置</span><br><span class="line">dn: olcOverlay=&#123;0&#125;memberof,olcDatabase=&#123;2&#125;hdb,cn=config</span><br><span class="line">objectClass: olcConfig</span><br><span class="line">objectClass: olcMemberOf</span><br><span class="line">objectClass: olcOverlayConfig</span><br><span class="line">objectClass: top</span><br><span class="line">olcOverlay: memberof</span><br><span class="line">olcMemberOfDangling: ignore</span><br><span class="line">olcMemberOfRefInt: TRUE</span><br><span class="line">olcMemberOfGroupOC: groupOfUniqueNames</span><br><span class="line">olcMemberOfMemberAD: uniqueMember</span><br><span class="line">olcMemberOfMemberOfAD: memberOf</span><br></pre></td></tr></table></figure>

<p>2.编辑refint1.ldif文件，内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@cdh01 openladp]# vim refint1.ldif</span><br><span class="line">dn: cn=module&#123;0&#125;,cn=config</span><br><span class="line">add: olcmoduleload</span><br><span class="line">olcmoduleload: refint</span><br></pre></td></tr></table></figure>

<p>3.编辑refint2.ldif文件，内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@cdh01 openladp]# vim refint2.ldif</span><br><span class="line">dn: olcOverlay=refint,olcDatabase=&#123;2&#125;hdb,cn=config</span><br><span class="line">objectClass: olcConfig</span><br><span class="line">objectClass: olcOverlayConfig</span><br><span class="line">objectClass: olcRefintConfig</span><br><span class="line">objectClass: top</span><br><span class="line">olcOverlay: refint</span><br><span class="line">olcRefintAttribute: memberof uniqueMember  manager owner</span><br></pre></td></tr></table></figure>

<p>4.执行如下命令将上述创建的3个文件导入到OpenLDAP中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@cdh01 openladp]# ldapadd -Q -Y EXTERNAL -H ldapi:/// -f  /data/disk1/openladp/memberof_conf.ldif</span><br><span class="line">[root@cdh01 openladp]# ldapmodify -Q -Y EXTERNAL -H ldapi:/// -f  /data/disk1/openladp/refint1.ldif</span><br><span class="line">[root@cdh01 openladp]# ldapadd -Q -Y EXTERNAL -H ldapi:/// -f /data/disk1/openladp/refint2.ldif</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>原文：<a href="https://cloud.tencent.com/developer/article/1349459" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1349459</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.newtao.vip/2020/04/13/openldap_memberof/" data-id="ckd6ppw4b002nq77868is38dv" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="true-openldap" class="article article-type-true" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/04/13/openldap/" class="article-date">
  <time datetime="2020-04-13T07:21:00.439Z" itemprop="datePublished">2020-04-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/04/13/openldap/">openldap centos7</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>1.环境</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">centos7</span><br></pre></td></tr></table></figure>

<p>2.install</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install openldap compat-openldap openldap-clients openldap-servers openldap-servers-sql openldap-devel</span><br></pre></td></tr></table></figure>

<p>3.启动服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start slapd</span><br><span class="line">systemctl enable slapd</span><br></pre></td></tr></table></figure>

<p>4.检查服务是否开启</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -antup | grep -i 389</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tcp        0      0 0.0.0.0:389             0.0.0.0:*               LISTEN      1520/slapd</span><br><span class="line">tcp6       0      0 :::389                  :::*                    LISTEN      1520/slapd</span><br></pre></td></tr></table></figure>

<p>5.设置管理员密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#生成密码 替换 ldppassword</span><br><span class="line">slappasswd -h &#123;SSHA&#125; -s ldppassword</span><br></pre></td></tr></table></figure>

<p>6.配置服务端<br>vi db.ldif</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">dn: olcDatabase=&#123;2&#125;hdb,cn=config</span><br><span class="line">changetype: modify</span><br><span class="line">replace: olcSuffix</span><br><span class="line">olcSuffix: dc=itzgeek,dc=local</span><br><span class="line"></span><br><span class="line">dn: olcDatabase=&#123;2&#125;hdb,cn=config</span><br><span class="line">changetype: modify</span><br><span class="line">replace: olcRootDN</span><br><span class="line">olcRootDN: cn=ldapadm,dc=itzgeek,dc=local</span><br><span class="line"></span><br><span class="line">dn: olcDatabase=&#123;2&#125;hdb,cn=config</span><br><span class="line">changetype: modify</span><br><span class="line">replace: olcRootPW</span><br><span class="line">olcRootPW: &apos;替换为5.生成的密码&apos;</span><br></pre></td></tr></table></figure>

<p>执行命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldapmodify -Y EXTERNAL  -H ldapi:/// -f db.ldif</span><br></pre></td></tr></table></figure>

<p>vi monitor.ldif</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dn: olcDatabase=&#123;1&#125;monitor,cn=config</span><br><span class="line">changetype: modify</span><br><span class="line">replace: olcAccess</span><br><span class="line">olcAccess: &#123;0&#125;to * by dn.base=&quot;gidNumber=0+uidNumber=0,cn=peercred,cn=external, cn=auth&quot; read by dn.base=&quot;cn=ldapadm,dc=itzgeek,dc=local&quot; read by * none</span><br></pre></td></tr></table></figure>

<p>执行命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldapmodify -Y EXTERNAL  -H ldapi:/// -f monitor.ldif</span><br></pre></td></tr></table></figure>

<p>7.配置ldap数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/share/openldap-servers/DB_CONFIG.example /var/lib/ldap/DB_CONFIG</span><br><span class="line">chown ldap:ldap /var/lib/ldap/*</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/cosine.ldif</span><br><span class="line">ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/nis.ldif </span><br><span class="line">ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/inetorgperson.ldif</span><br></pre></td></tr></table></figure>

<p>8.配置域名base信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">dn: dc=itzgeek,dc=local</span><br><span class="line">dc: itzgeek</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: domain</span><br><span class="line"></span><br><span class="line">dn: cn=ldapadm ,dc=itzgeek,dc=local</span><br><span class="line">objectClass: organizationalRole</span><br><span class="line">cn: ldapadm</span><br><span class="line">description: LDAP Manager</span><br><span class="line"></span><br><span class="line">dn: ou=People,dc=itzgeek,dc=local</span><br><span class="line">objectClass: organizationalUnit</span><br><span class="line">ou: People</span><br><span class="line"></span><br><span class="line">dn: ou=Group,dc=itzgeek,dc=local</span><br><span class="line">objectClass: organizationalUnit</span><br><span class="line">ou: Group</span><br></pre></td></tr></table></figure>

<p>执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldapadd -x -W -D &quot;cn=ldapadm,dc=itzgeek,dc=local&quot; -f base.ldif</span><br></pre></td></tr></table></figure>

<p>9.创建用户<br>vi raj.ldif</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">dn: uid=raj,ou=People,dc=itzgeek,dc=local</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: account</span><br><span class="line">objectClass: posixAccount</span><br><span class="line">objectClass: shadowAccount</span><br><span class="line">cn: raj</span><br><span class="line">uid: raj</span><br><span class="line">uidNumber: 9999</span><br><span class="line">gidNumber: 100</span><br><span class="line">homeDirectory: /home/raj</span><br><span class="line">loginShell: /bin/bash</span><br><span class="line">gecos: Raj [Admin (at) ITzGeek]</span><br><span class="line">userPassword: &#123;crypt&#125;x</span><br><span class="line">shadowLastChange: 17058</span><br><span class="line">shadowMin: 0</span><br><span class="line">shadowMax: 99999</span><br><span class="line">shadowWarning: 7</span><br></pre></td></tr></table></figure>

<p>执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldapadd -x -W -D &quot;cn=ldapadm,dc=itzgeek,dc=local&quot; -f raj.ldif</span><br></pre></td></tr></table></figure>

<p>修改密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldappasswd -s password123 -W -D &quot;cn=ldapadm,dc=itzgeek,dc=local&quot; -x &quot;uid=raj,ou=People,dc=itzgeek,dc=local&quot;</span><br></pre></td></tr></table></figure>

<ol start="10">
<li>验证<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldapsearch -x cn=raj -b dc=itzgeek,dc=local</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"># extended LDIF</span><br><span class="line">#</span><br><span class="line"># LDAPv3</span><br><span class="line"># base &lt;dc=itzgeek,dc=local&gt; with scope subtree</span><br><span class="line"># filter: cn=raj</span><br><span class="line"># requesting: ALL</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line"># raj, People, itzgeek.local</span><br><span class="line">dn: uid=raj,ou=People,dc=itzgeek,dc=local</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: account</span><br><span class="line">objectClass: posixAccount</span><br><span class="line">objectClass: shadowAccount</span><br><span class="line">cn: raj</span><br><span class="line">uid: raj</span><br><span class="line">uidNumber: 9999</span><br><span class="line">gidNumber: 100</span><br><span class="line">homeDirectory: /home/raj</span><br><span class="line">loginShell: /bin/bash</span><br><span class="line">gecos: Raj [Admin (at) ITzGeek]</span><br><span class="line">shadowLastChange: 17058</span><br><span class="line">shadowMin: 0</span><br><span class="line">shadowMax: 99999</span><br><span class="line">shadowWarning: 7</span><br><span class="line">userPassword:: e1NTSEF9MkE2eUhIS0pJQVRnMHBCdkpVWjR5Q3JvTkJLTzdBTWY=</span><br><span class="line"></span><br><span class="line"># search result</span><br><span class="line">search: 2</span><br><span class="line">result: 0 Success</span><br><span class="line"></span><br><span class="line"># numResponses: 2</span><br><span class="line"># numEntries: 1</span><br></pre></td></tr></table></figure>

<p>删除</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldapdelete -W -D &quot;cn=ldapadm,dc=itzgeek,dc=local&quot; &quot;uid=raj,ou=People,dc=itzgeek,dc=local&quot;</span><br></pre></td></tr></table></figure>

<p>11.防火墙</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent --add-service=ldap</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>

<p>12.开启日志<br>vi /etc/rsyslog.conf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#增加</span><br><span class="line">local4.* /var/log/ldap.log</span><br><span class="line">#执行</span><br><span class="line">systemctl restart rsyslog</span><br></pre></td></tr></table></figure>

<ol start="13">
<li>客户端配置<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install -y openldap-clients nss-pam-ldapd</span><br><span class="line">authconfig --enableldap --enableldapauth --ldapserver=192.168.1.10 --ldapbasedn=&quot;dc=itzgeek,dc=local&quot; --enablemkhomedir --update</span><br><span class="line">systemctl restart  nslcd</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>14.验证</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getent passwd raj</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">raj:x:9999:100:Raj [Admin (at) ITzGeek]:/home/raj:/bin/bash</span><br></pre></td></tr></table></figure>

<p>15.<br>原文: <a href="https://www.itzgeek.com/how-tos/linux/centos-how-tos/step-step-openldap-server-configuration-centos-7-rhel-7.html" target="_blank" rel="noopener">https://www.itzgeek.com/how-tos/linux/centos-how-tos/step-step-openldap-server-configuration-centos-7-rhel-7.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.newtao.vip/2020/04/13/openldap/" data-id="ckd6ppw48002lq778umt9xnid" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/2/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/4/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CTF/">CTF</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Docker/">Docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/GIT/">GIT</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mac/">Mac</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mysql/">Mysql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/shell/">shell</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/中间件/">中间件</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/交易所/">交易所</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端/">前端</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/区块链/">区块链</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/后端/">后端</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/微服务/">微服务</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/汇编/">汇编</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/源码/">源码</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络安全/">网络安全</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/运维/">运维</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/阿里云/">阿里云</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/07/29/sshd_ip/">防火墙ssh白名单</a>
          </li>
        
          <li>
            <a href="/2020/07/15/aliyun_disk/">磁盘扩容</a>
          </li>
        
          <li>
            <a href="/2020/07/10/wget_c/">wget</a>
          </li>
        
          <li>
            <a href="/2020/07/08/ctf/">安全领域资源</a>
          </li>
        
          <li>
            <a href="/2020/07/08/asm/">汇编指令集</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 anonymous<br>
      Powered by <a href="https://baike.baidu.com/item/%E5%8C%BF%E5%90%8D%E8%80%85%E9%BB%91%E5%AE%A2%E7%BB%84%E7%BB%87/8378313?fromtitle=Anonymous&fromid=7157039&fr=aladdin" target="_blank">H</a>
      <a href="http://beian.miit.gov.cn">鲁ICP备18014570号</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="/js/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  </div>
    <!-- waifu-tips.js 依赖 JQuery 库 -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
    <!-- 实现拖动效果，需引入 JQuery UI -->
    <script src="https://cdn.jsdelivr.net/npm/jquery-ui-dist@1.12.1/jquery-ui.min.js"></script>
    <script src="images/assets/autoload.js?v=1.4.2"></script>
</body>
</html>
